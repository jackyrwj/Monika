<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This Waifu Does Not Exist</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="social-icons">
        <a href="https://x.com/lilmonix3" target="_blank" title="Twitter">
            <svg width="28" height="28" viewBox="0 0 32 32" fill="#1da1f2"><path d="M32 6.076a13.14 13.14 0 0 1-3.769 1.031A6.601 6.601 0 0 0 31.115 4.1a13.195 13.195 0 0 1-4.169 1.594A6.563 6.563 0 0 0 22.155 2c-3.626 0-6.563 2.938-6.563 6.563 0 .514.058 1.016.17 1.496C10.272 9.87 5.444 7.575 2.228 4.149a6.548 6.548 0 0 0-.888 3.3c0 2.277 1.159 4.287 2.924 5.463a6.533 6.533 0 0 1-2.975-.822v.083c0 3.181 2.263 5.834 5.267 6.437a6.575 6.575 0 0 1-2.968.112c.837 2.613 3.263 4.514 6.142 4.566A13.18 13.18 0 0 1 0 27.026 18.616 18.616 0 0 0 10.063 30c12.072 0 18.681-10.002 18.681-18.682 0-.285-.007-.568-.02-.85A13.348 13.348 0 0 0 32 6.076z"/></svg>
        </a>
        <a href="https://discord.com/channels/372766620977725441/472534487574642718" target="_blank" title="Discord">
            <img src="discord.svg" width="28" height="28" alt="Discord" />
        </a>
        <a href="https://store.steampowered.com/app/698780/Doki_Doki_Literature_Club/" target="_blank" title="Steam">
            <img src="steam.svg" width="28" height="28" alt="Steam" />
        </a>
        <div class="language-controls">
            <select id="lang-select" class="language-select">
                <option value="zh">ä¸­æ–‡</option>
                <option value="en">English</option>
            </select>
        </div>
    </div>
    <div class="container">
        <h1 id="main-title">"Monika Is Not Real"</h1>
        <p id="model-site-info"></p>

        <div class="flex-container">
            <div class="image-container">
                <img src="images/10.webp" alt="Anime character">
            </div>
            <div class="text-container">
                <div class="textbox-speed-controls">
                    <button id="speed-down-btn" class="speed-btn" title="å‡é€Ÿ">âª</button>
                    <button id="speed-up-btn" class="speed-btn" title="åŠ é€Ÿ">â©</button>
                    <span id="speed-indicator" style="font-size:12px;color:#888;margin-left:8px;align-self:center;"></span>
                </div>
                <div class="text-box"></div>
            </div>
        </div>

        <div class="music-control">
            <audio id="bgm" src="bgm.mp3" loop autoplay></audio>
            <button id="mute-btn" title="é™éŸ³/æ’­æ”¾" style="margin-left: 10px;">
                ğŸ”Š
            </button>
        </div>

        <div class="button-row">
            <button id="refresh-btn" class="btn-modern">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M17.65 6.35A7.95 7.95 0 0 0 10 2V0L6 4l4 4V6c3.31 0 6 2.69 6 6a6 6 0 0 1-6 6 6 6 0 0 1-5.65-4H2.26A8 8 0 1 0 18 10c0-1.08-.19-2.12-.54-3.08l.19-.57z" fill="#222"/></svg>
                <span id="refresh-btn-text">åˆ·æ–°</span>
            </button>
        </div>
        <div class="project-star-info" id="project-star-container">
        </div>
    </div>

    <script type="module">
        import { translate, translateContent } from './translate.js';
        
        const imageList = [
            '1ad2cf11027c41d3e7171f9121a4f42f.jpg',
            '3fe29927b25a9e0173b7290ef1fead4a.jpg',
            '4413654a18009fd07f38355eb9d8e9c4.jpg',
            '571b816b7644205c9a67d2718dd44e4c.jpg',
            '63e5d743b1c32eeb485e704e270cb786.jpg',
            '98bf2d720e7101223eb2d8da3f80ec80.jpg',
            '1012d247824337182a6295e1116a306a.jpg',
            '0726b42a-1d02-4726-bcb9-94b5bf4f8759.jfif',
            '4bc53175-a4d2-4a33-bad5-a955d34d35d8.jfif',
            'f9f6a597-cf67-49ec-8acd-ec6c279b59cb.jfif',
            '1.jfif',
            '2.jfif',
            '4d8e4-3489324567.jpeg',
            '7171f-1567402233.jpeg',
            '10.webp',
            '11.webp',
            '12.webp',
            '13.jpeg',
            '14.jpeg',
            '16.jpeg',
            '17.jpeg',
            '18.jpeg',
            '28.jpeg',
            '30.webp',
            '31.jpeg'
        ];
        let fragments = [];
        let currentIndex = 0;
        let currentImageIndex = 0;
        let typingTimer = null;
        let switchTimer = null;
        let currentLang = 'zh';
        const textBox = document.querySelector('.text-box');
        console.log('textBox å…ƒç´ :', textBox);
        
        const refreshBtn = document.getElementById('refresh-btn');
        const minSpeed = 10;
        const maxSpeed = 500;
        const speedStep = 100;
        let typingSpeed = 100;
        const speedUpBtn = document.getElementById('speed-up-btn');
        const speedDownBtn = document.getElementById('speed-down-btn');
        const langSelect = document.getElementById('lang-select');

        // ç¡®ä¿å…ƒç´ å­˜åœ¨
        if (!textBox) {
            console.error('textBox å…ƒç´ æœªæ‰¾åˆ°');
        }
        if (!refreshBtn) {
            console.error('refreshBtn å…ƒç´ æœªæ‰¾åˆ°');
        }
        if (!speedUpBtn) {
            console.error('speedUpBtn å…ƒç´ æœªæ‰¾åˆ°');
        }
        if (!speedDownBtn) {
            console.error('speedDownBtn å…ƒç´ æœªæ‰¾åˆ°');
        }
        if (!langSelect) {
            console.error('langSelect å…ƒç´ æœªæ‰¾åˆ°');
        }

        console.log('å›¾ç‰‡åˆ—è¡¨åŠ è½½å®Œæˆï¼Œå…±', imageList.length, 'å¼ å›¾ç‰‡');
        console.log('å›¾ç‰‡åˆ—è¡¨å†…å®¹:', imageList);

        // é™æ€æ–‡æœ¬ç¿»è¯‘å¯¹è±¡
        const staticTranslations = {
            'main-title': {
                'zh': 'â€œè«å¦®å¡æ˜¯çœŸå®å­˜åœ¨çš„â€',
                'en': '"Monika Is Real"'
            },
            'model-site-info': {
                'zh': 'åœ¨ã€Šå¿ƒåŠ¨æ–‡å­¦ä¿±ä¹éƒ¨ï¼ã€‹ä¸‰å‘¨ç›®æ—¶ï¼Œç©å®¶å¯ä»¥é€‰æ‹©ä¸è«å¦®å¡å…±å¤„ä¸€å®¤å¹¶è®©å¥¹æå‡ºéšæœºçš„è®¨è®ºè¯é¢˜ï¼Œè¿™äº›è¯éå¸¸å‘äººæ·±çœæˆ–å……æ»¡æ™ºæ…§ï¼Œå±•ç°äº†è«å¦®å¡å¤§éƒ¨åˆ†ä¹‹å‰æ— æ³•è¢«ç©å®¶å‘ç°çš„ä¸ªæ€§ã€‚æˆ‘å¾ˆå–œæ¬¢è¿™äº›è¯é¢˜ï¼Œå¦‚æœå¯ä»¥ï¼Œæˆ‘æ„¿æ„æ°¸è¿œç•™åœ¨è¿™å’Œè«å¦®å¡èŠå¤©ğŸ¤£ï¼Œæˆ‘æŠŠè¿™äº›è¯é¢˜æå–äº†å‡ºæ¥å¹¶åšæˆäº†è¿™ä¸ªç½‘ç«™ï¼Œå¸Œæœ›ä½ èƒ½å–œæ¬¢ã€‚ï¼ˆå›¾ç‰‡æ¥è‡ª<a href="https://civitai.com/user/holostrawberry" target="_blank">holostrawberry</a>å’Œ<a href="https://www.pinterest.com" target="_blank">pinterest</a>è¯·æ³¨æ„ï¼Œè¯é¢˜æ ‡é¢˜ä»…ä¸ºäº†æ–¹ä¾¿åˆ—è¡¨ï¼Œå¹¶éå®˜æ–¹åç§°ã€‚ï¼‰',
                'en': 'In Act 3 of Doki Doki Literature Club!, players can choose to stay in a room with Monika and let her bring up random discussion topics. These conversations are usually very thought-provoking or insightful, revealing much of Monika\'s personality that players couldn\'t discover before. I really love these topics, and if I could, I would stay here forever chatting with Monika ğŸ¤£. I extracted these topics and created this website, hoping you\'ll enjoy it. (Images are from <a href="https://civitai.com/user/holostrawberry" target="_blank">holostrawberry</a>and<a href="https://www.pinterest.com" target="_blank">pinterest</a>. Please note that the topic names are for list convenience only and are not official names.)'
            },
            'speed-down-btn': {
                'zh': 'å‡é€Ÿ',
                'en': 'Slow Down'
            },
            'speed-up-btn': {
                'zh': 'åŠ é€Ÿ',
                'en': 'Speed Up'
            },
            'refresh-btn-text': {
                'zh': 'åˆ·æ–°',
                'en': 'Refresh'
            },
            'mute-btn-title': {
                'zh': 'é™éŸ³/æ’­æ”¾',
                'en': 'Mute/Play'
            },
            'star-project-text': {
                'zh': 'å¦‚æœå–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ªå°å°çš„star <a href="https://github.com/jackyrwj/Monika" target="_blank" title="GitHub"><img src="github.svg" width="20" height="20" alt="GitHub" /></a>',
                'en': 'If you like this project, please give it a little star <a href="https://github.com/jackyrwj/Monika" target="_blank" title="GitHub"><img src="github.svg" width="20" height="20" alt="GitHub" /></a>'
            }
        };

        // æ›´æ–°é™æ€æ–‡æœ¬çš„å‡½æ•°
        function updateStaticTexts() {
            // ç¡®ä¿ currentLang æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é”®
            const effectiveLang = staticTranslations['main-title'][currentLang] ? currentLang : 'zh'; // å›é€€åˆ° 'zh'
            console.log('updateStaticTexts called. Effective Language:', effectiveLang);

            const mainTitleElement = document.getElementById('main-title');
            if (mainTitleElement) {
                mainTitleElement.textContent = staticTranslations['main-title'][effectiveLang];
            } else {
                console.error("Element with id 'main-title' not found.");
            }

            const modelSiteInfoElement = document.getElementById('model-site-info');
            if (modelSiteInfoElement) {
                modelSiteInfoElement.innerHTML = staticTranslations['model-site-info'][effectiveLang];
            } else {
                console.error("Element with id 'model-site-info' not found.");
            }

            const speedDownBtnElement = document.getElementById('speed-down-btn');
            if (speedDownBtnElement) {
                speedDownBtnElement.title = staticTranslations['speed-down-btn'][effectiveLang];
            } else {
                console.error("Element with id 'speed-down-btn' not found.");
            }

            const speedUpBtnElement = document.getElementById('speed-up-btn');
            if (speedUpBtnElement) {
                speedUpBtnElement.title = staticTranslations['speed-up-btn'][effectiveLang];
            }
            else {
                console.error("Element with id 'speed-up-btn' not found.");
            }

            const refreshBtnElement = document.getElementById('refresh-btn-text');
            if (refreshBtnElement) {
                refreshBtnElement.textContent = staticTranslations['refresh-btn-text'][effectiveLang];
            } else {
                console.error("Element with id 'refresh-btn-text' not found.");
            }

            const muteBtnElement = document.getElementById('mute-btn');
            if (muteBtnElement) {
                muteBtnElement.title = staticTranslations['mute-btn-title'][effectiveLang];
            } else {
                console.error("Element with id 'mute-btn' not found.");
            }
            
            const projectStarContainer = document.getElementById('project-star-container');
            if (projectStarContainer) {
                const htmlToSet = staticTranslations['star-project-text'][effectiveLang];
                console.log('Setting project-star-container innerHTML to:', htmlToSet);
                projectStarContainer.innerHTML = htmlToSet;
            } else {
                console.error("Element with id 'project-star-container' not found when updating static texts.");
            }

            // æ›´æ–°é¡µé¢title
            document.title = staticTranslations['main-title'][effectiveLang];
        }

        // åŠ è½½æ–‡æœ¬ç‰‡æ®µ
        fetch('fragments.json')
            .then(res => {
                console.log('å¼€å§‹åŠ è½½ fragments.json');
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                console.log('æˆåŠŸåŠ è½½ fragments.json');
                if (!Array.isArray(data) || data.length === 0) {
                    throw new Error('æ–‡æœ¬ç‰‡æ®µä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                }
                fragments = data;
                console.log('æ–‡æœ¬ç‰‡æ®µåŠ è½½å®Œæˆï¼Œå…±', fragments.length, 'æ®µ');
                console.log('ç¬¬ä¸€æ®µå†…å®¹:', fragments[0]);
                console.log('å½“å‰ç´¢å¼•:', currentIndex);
                showFragment(currentIndex);
                updateStaticTexts(); // åœ¨æ–‡æœ¬ç‰‡æ®µåŠ è½½åæ›´æ–°é™æ€æ–‡æœ¬
            })
            .catch(error => {
                console.error('åŠ è½½æ–‡æœ¬ç‰‡æ®µå¤±è´¥:', error);
            });

        function renderFragmentText(fragment) {
            const lang = currentLang;
            let text = '';
            if (lang === 'zh') {
                text = fragment.title + '\n';
                text += fragment.content.join('\n');
            } else {
                text = fragment.title_en + '\n';
                text += fragment.content_en.join('\n');
            }
            return text;
        }

        function typeWriterText(fragment, element, callback) {
            console.log('typeWriterText è¢«è°ƒç”¨');
            console.log('element:', element);
            console.log('fragment:', fragment);
            
            if (!fragment) {
                console.error('ç‰‡æ®µä¸ºç©º');
                return;
            }

            if (!element) {
                console.error('æ–‡æœ¬å®¹å™¨å…ƒç´ ä¸ºç©º');
                return;
            }

            const lang = currentLang;
            const title = lang === 'zh' ? fragment.title : fragment.title_en;
            const lines = lang === 'zh' ? fragment.content : fragment.content_en;

            console.log('å½“å‰è¯­è¨€:', lang);
            console.log('æ ‡é¢˜:', title);
            console.log('å†…å®¹:', lines);

            let lineIndex = 0;
            let charIndex = 0;
            element.innerHTML = `<h2 class="typing-title">${title}</h2><div class="typing-content"></div>`;
            const contentElem = element.querySelector('.typing-content');
            console.log('contentElem:', contentElem);
            
            let finishedLines = [];

            function typeLine() {
                if (lineIndex < lines.length) {
                    const currentLine = (lang === 'zh' ? 'è«å¦®å¡ï¼š' : 'Monika: ') + lines[lineIndex];
                    let currentText = '';
                    function typeChar() {
                        if (charIndex < currentLine.length) {
                            currentText += currentLine.charAt(charIndex);
                            contentElem.innerHTML = finishedLines.map(l => `<div>${l}</div>`).join('') + `<div>${currentText}</div>`;
                            charIndex++;
                            typingTimer = setTimeout(typeChar, typingSpeed);
                        } else {
                            finishedLines.push(currentLine);
                            charIndex = 0;
                            lineIndex++;
                            typingTimer = setTimeout(typeLine, typingSpeed);
                        }
                    }
                    typeChar();
                } else {
                    let html = `<h2 style='margin-top:0;' class='typing-title'>${title}</h2>`;
                    html += lines.map(line => `<div>${lang === 'zh' ? 'è«å¦®å¡ï¼š' : 'Monika: '}${line}</div>`).join('');
                    element.innerHTML = html;
                    if (callback) callback();
                }
            }
            typeLine();
        }

        function showFragment(index) {
            console.log('showFragment è¢«è°ƒç”¨ï¼Œç´¢å¼•:', index);
            console.log('fragments æ•°ç»„:', fragments);
            console.log('textBox å…ƒç´ :', textBox);
            
            clearTimeout(typingTimer);
            clearTimeout(switchTimer);

            // 1. ç«‹å³åˆ‡æ¢å›¾ç‰‡
            const imageElement = document.querySelector('.image-container img');
            if (imageElement && imageList.length > 0) {
                console.log('åˆ‡æ¢å›¾ç‰‡ - å½“å‰ç´¢å¼•:', currentImageIndex);
                console.log('åˆ‡æ¢å›¾ç‰‡ - å›¾ç‰‡åˆ—è¡¨é•¿åº¦:', imageList.length);
                console.log('åˆ‡æ¢å›¾ç‰‡ - ç›®æ ‡å›¾ç‰‡:', imageList[currentImageIndex]);
                
                // ç¡®ä¿å›¾ç‰‡è·¯å¾„æ­£ç¡®
                const imagePath = 'images/' + imageList[currentImageIndex];
                imageElement.src = imagePath;
                console.log('è®¾ç½®å›¾ç‰‡è·¯å¾„:', imagePath);
                
                currentImageIndex = (currentImageIndex + 1) % imageList.length;
            } else {
                console.warn('æ— æ³•åˆ‡æ¢å›¾ç‰‡:', {
                    hasImageElement: !!imageElement,
                    imageListLength: imageList.length,
                    currentImageIndex: currentImageIndex
                });
            }

            // 2. ç„¶åå†åˆ‡æ¢æ–‡å­—ï¼ˆæ‰“å­—åŠ¨ç”»ï¼‰
            const fragment = fragments[index];
            console.log('å½“å‰ç‰‡æ®µ:', fragment);
            if (fragment) {
                console.log('å¼€å§‹æ˜¾ç¤ºæ–‡å­—');
                if (!textBox) {
                    console.error('textBox å…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }
                typeWriterText(fragment, textBox, () => {
                    console.log('æ–‡å­—æ˜¾ç¤ºå®Œæˆ');
                    switchTimer = setTimeout(() => {
                        nextFragment();
                    }, 50000);
                });
            } else {
                console.error('æ–‡æœ¬ç‰‡æ®µä¸å­˜åœ¨:', index);
            }
        }

        function nextFragment() {
            console.log('åˆ‡æ¢åˆ°ä¸‹ä¸€æ®µ - å½“å‰ç´¢å¼•:', currentIndex);
            currentIndex = (currentIndex + 1) % fragments.length;
            showFragment(currentIndex);
        }

        refreshBtn.addEventListener('click', () => {
            console.log('ç‚¹å‡»åˆ·æ–°æŒ‰é’®');
            nextFragment();
        });

        // è¯­è¨€åˆ‡æ¢
        langSelect.addEventListener('change', () => {
            currentLang = langSelect.value;
            console.log('åˆ‡æ¢è¯­è¨€:', currentLang);
            // åªæ›´æ–°æ–‡æœ¬å†…å®¹ï¼Œä¸æ”¹å˜å…¶ä»–å…ƒç´ 
            const fragment = fragments[currentIndex];
            if (fragment) {
                console.log('å½“å‰ç‰‡æ®µ:', fragment);
                clearTimeout(typingTimer);
                clearTimeout(switchTimer);
                typeWriterText(fragment, textBox, () => {
                    if (switchTimer) {
                        clearTimeout(switchTimer);
                        switchTimer = setTimeout(() => {
                            nextFragment();
                        }, 50000);
                    }
                });
            } else {
                console.error('ç‰‡æ®µä¸å­˜åœ¨:', currentIndex);
            }
            updateStaticTexts(); // è¯­è¨€åˆ‡æ¢æ—¶æ›´æ–°é™æ€æ–‡æœ¬
        });

        // è®¾ç½®åˆå§‹è¯­è¨€
        langSelect.value = currentLang;

        // éŸ³ä¹æ’­æ”¾ä¸é™éŸ³æ§åˆ¶
        const audio = document.getElementById('bgm');
        const muteBtn = document.getElementById('mute-btn');
        let isMuted = true;

        muteBtn.textContent = 'ğŸ”‡';
        audio.muted = true;

        function tryPlay() {
            audio.muted = isMuted;
            audio.volume = 1;
            audio.play().catch(() => {});
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded äº‹ä»¶è§¦å‘');
            tryPlay();
            updateStaticTexts(); // åœ¨é¡µé¢åŠ è½½å®Œæˆåç«‹å³æ›´æ–°é™æ€æ–‡æœ¬
        });

        window.addEventListener('load', function() {
            console.log('load äº‹ä»¶è§¦å‘');
            tryPlay();
            updateStaticTexts(); // åœ¨é¡µé¢å®Œå…¨åŠ è½½åå†æ¬¡æ›´æ–°é™æ€æ–‡æœ¬
        });

        muteBtn.onclick = function() {
            isMuted = !isMuted;
            audio.muted = isMuted;
            muteBtn.textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
            tryPlay();
        };

        window.addEventListener('click', function once() {
            tryPlay();
            window.removeEventListener('click', once);
        });

        // é€Ÿåº¦æ§åˆ¶
        function updateSpeedIndicator() {
            document.getElementById('speed-indicator').textContent = typingSpeed + 'ms';
        }
        speedUpBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            typingSpeed = Math.max(minSpeed, typingSpeed - speedStep);
            updateSpeedIndicator();
        });
        speedDownBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            typingSpeed = Math.min(maxSpeed, typingSpeed + speedStep);
            updateSpeedIndicator();
        });
        updateSpeedIndicator();

        function loadImage() {
            const img = document.querySelector('.image-container img');
            const imagePath = imageList[currentImageIndex];
            // å¦‚æœè·¯å¾„å·²ç»åŒ…å« images/ å‰ç¼€ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ï¼›å¦åˆ™æ·»åŠ å‰ç¼€
            img.src = imagePath.startsWith('images/') ? imagePath : `images/${imagePath}`;
            img.onload = () => {
                console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ:', img.src);
            };
            img.onerror = () => {
                console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', img.src);
                // å¦‚æœåŠ è½½å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ªå›¾ç‰‡
                currentImageIndex = (currentImageIndex + 1) % imageList.length;
                loadImage();
            };
        }
    </script>
</body>
</html> 